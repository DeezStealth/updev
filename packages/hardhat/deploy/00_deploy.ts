import { HardhatRuntimeEnvironment } from "hardhat/types";
import { DeployFunction } from "hardhat-deploy/types";
import getSourceCode from "../sources/get";

const wait = (sec: number) => new Promise(resolve => setTimeout(resolve, sec * 1000));

const deployYourContract: DeployFunction = async function (hre: HardhatRuntimeEnvironment) {
  const { deployer } = await hre.getNamedAccounts();
  const { deploy } = hre.deployments;

  const signer = new hre.ethers.Wallet(process.env.DEPLOYER_PRIVATE_KEY || "", hre.ethers.provider);

  // TODO extract Nick factory deployments

  // For more information check: https://github.com/Arachnid/deterministic-deployment-proxy
  const NICK_FACTORY_ADDRESS = "0x4e59b44847b379578588920ca78fbf26c0b4956c";

  const LSP23_FACTORY_ADDRESS = "0x2300000a84d25df63081feaa37ba6b62c4c89a30";
  const UP_INIT_ADDRESS = "0x000000000066093407b6704b89793beffd0d8f00"; // TODO Post Deployment address?
  const KEY_MANAGER_INIT_ADDRESS = "0xa75684d7d048704a2db851d05ba0c3cbe226264c";
  const LSP1_URD_ADDRESS = "0xa5467dfe7019bf2c7c5f7a707711b9d4cad118c8";

  const checkDeployedCode = async (address: any) => {
    const code = await hre.ethers.provider.getCode(address);
    return code !== "0x";
  };

  const isNickFactoryDeployed = await checkDeployedCode(NICK_FACTORY_ADDRESS);
  const isLSP23FactoryDeployed = await checkDeployedCode(LSP23_FACTORY_ADDRESS);
  const isKeyManagerInitDeployed = await checkDeployedCode(KEY_MANAGER_INIT_ADDRESS);
  const isUPInitDeployed = await checkDeployedCode(UP_INIT_ADDRESS);
  const isLSP1URDDeployed = await checkDeployedCode(LSP1_URD_ADDRESS);

  console.log("isNickFactoryDeployed", isNickFactoryDeployed);
  console.log("isLSP23FactoryDeployed", isLSP23FactoryDeployed);
  console.log("isKeyManagerInitDeployed", isKeyManagerInitDeployed);
  console.log("isUPInitDeployed", isUPInitDeployed);
  console.log("isLSP1URDDeployed", isLSP1URDDeployed);

  if (!isNickFactoryDeployed) {
    const fundingTx = await signer.sendTransaction({
      // Standardized address
      to: "0x3fab184622dc19b6109349b94811493bf2a45362",
      value: hre.ethers.utils.parseEther("0.009"), // This value should be enough
      // Check gasLimit and gasPrice to estimate exactly the value: https://github.com/Arachnid/deterministic-deployment-proxy
    });
    await fundingTx.wait();

    // Sending raw transaction specified by the Nick factory
    const rawTx =
      "0xf8a58085174876e800830186a08080b853604580600e600039806000f350fe7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe03601600081602082378035828234f58015156039578182fd5b8082525050506014600cf31ba02222222222222222222222222222222222222222222222222222222222222222a02222222222222222222222222222222222222222222222222222222222222222";
    const deployNickFactoryTx = await hre.ethers.provider.send(rawTx, []);
    // const deployNickFactoryTx = await hre.ethers.provider.broadcastTransaction(rawTx);
    await deployNickFactoryTx.wait();
    console.log("Nick deployed");
  }

  if (!isLSP23FactoryDeployed) {
    const lsp23Tx = await signer.sendTransaction({
      to: NICK_FACTORY_ADDRESS,
      data: "0x12a6712f113536d8b01d99f72ce168c7e1090124db54cd16f03c20000022178c608060405234801561001057600080fd5b50611247806100206000396000f3fe60806040526004361061003f5760003560e01c80636a66a7531461004457806372b19d361461007b578063754b86b51461009b578063dd5940f3146100ae575b600080fd5b610057610052366004610c0b565b6100ce565b604080516001600160a01b0393841681529290911660208301520160405180910390f35b34801561008757600080fd5b50610057610096366004610c0b565b610204565b6100576100a9366004610cb4565b61028d565b3480156100ba57600080fd5b506100576100c9366004610cb4565b610324565b6000806100e086356020890135610d28565b34146100ff57604051632fd9ca9160e01b815260040160405180910390fd5b61010c878787878761047d565b9150610118868361056c565b9050806001600160a01b0316826001600160a01b03167fe20570ed9bda3b93eea277b4e5d975c8933fd5f85f2c824d0845ae96c55a54fe8989898989604051610165959493929190610de1565b60405180910390a36001600160a01b038516156101fa576040517f28c4d14e0000000000000000000000000000000000000000000000000000000081526001600160a01b038616906328c4d14e906101c7908590859089908990600401610eed565b600060405180830381600087803b1580156101e157600080fd5b505af11580156101f5573d6000803e3d6000fd5b505050505b9550959350505050565b6000806000610216888888888861071a565b905061023161022b60608a0160408b01610f24565b82610795565b92506102806102466040890160208a01610f24565b6040516bffffffffffffffffffffffff19606087901b16602082015260340160405160208183030381529060405280519060200120610795565b9150509550959350505050565b60008061029f86356020890135610d28565b34146102be57604051632fd9ca9160e01b815260040160405180910390fd5b6102cb87878787876107fa565b91506102d78683610867565b9050806001600160a01b0316826001600160a01b03167f0e20ea3d6273aab49a7dabafc15cc94971c12dd63a07185ca810e497e4e87aa68989898989604051610165959493929190610f3f565b60008060006103368888888888610966565b90506103648161034960408b018b610fdf565b604051610357929190611026565b60405180910390206109af565b9250606061037788820160408a01611036565b156103e4576103896020890189610fdf565b604080516001600160a01b03881660208201520160408051601f198184030181529190526103ba60608c018c610fdf565b6040516020016103ce959493929190611075565b6040516020818303038152906040529050610429565b6103f16020890189610fdf565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509293505050505b6040516bffffffffffffffffffffffff19606086901b16602082015261046f906034016040516020818303038152906040528051906020012082805190602001206109af565b925050509550959350505050565b60008061048d878787878761071a565b90506104a86104a26060890160408a01610f24565b826109bc565b91506000806001600160a01b03841660208a01356104c960608c018c610fdf565b6040516104d7929190611026565b60006040518083038185875af1925050503d8060008114610514576040519150601f19603f3d011682016040523d82523d6000602084013e610519565b606091505b50915091508161056057806040517f4364b6ee00000000000000000000000000000000000000000000000000000000815260040161055791906110a9565b60405180910390fd5b50505095945050505050565b60006105bb6105816040850160208601610f24565b6040516bffffffffffffffffffffffff19606086901b166020820152603401604051602081830303815290604052805190602001206109bc565b905060006105cc6040850185610fdf565b8080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250929350610614925050506080850160608601611036565b1561067157604080516001600160a01b038516602082015282910160408051601f1981840301815291905261064c6080870187610fdf565b60405160200161065f94939291906110dc565b60405160208183030381529060405290505b600080836001600160a01b03168660000135846040516106919190611118565b60006040518083038185875af1925050503d80600081146106ce576040519150601f19603f3d011682016040523d82523d6000602084013e6106d3565b606091505b50915091508161071157806040517f9654a85400000000000000000000000000000000000000000000000000000000815260040161055791906110a9565b50505092915050565b6000853561072e6040870160208801610f24565b61073b6040880188610fdf565b61074b60808a0160608b01611036565b61075860808b018b610fdf565b8a8a8a6040516020016107749a99989796959493929190611134565b60405160208183030381529060405280519060200120905095945050505050565b6040513060388201526f5af43d82803e903d91602b57fd5bf3ff602482015260148101839052733d602d80600a3d3981f3363d3d373d3d3d363d738152605881018290526037600c820120607882015260556043909101206000905b90505b92915050565b60008061080a8787878787610966565b905061085c60208801358261082260408b018b610fdf565b8080601f016020809104026020016040519081016040528093929190818152602001838380828437600092019190915250610a5992505050565b979650505050505050565b6000806108776020850185610fdf565b8080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152509293506108bf925050506060850160408601611036565b1561091c57604080516001600160a01b038516602082015282910160408051601f198184030181529190526108f76060870187610fdf565b60405160200161090a94939291906110dc565b60405160208183030381529060405290505b6040516bffffffffffffffffffffffff19606085901b16602082015261095e908535906034016040516020818303038152906040528051906020012083610a59565b949350505050565b600085356109776020870187610fdf565b6109876060890160408a01611036565b61099460608a018a610fdf565b898989604051602001610774999897969594939291906111a8565b60006107f1838330610b64565b6000763d602d80600a3d3981f3363d3d373d3d3d363d730000008360601b60e81c176000526e5af43d82803e903d91602b57fd5bf38360781b1760205281603760096000f590506001600160a01b0381166107f45760405162461bcd60e51b815260206004820152601760248201527f455243313136373a2063726561746532206661696c65640000000000000000006044820152606401610557565b600083471015610aab5760405162461bcd60e51b815260206004820152601d60248201527f437265617465323a20696e73756666696369656e742062616c616e63650000006044820152606401610557565b8151600003610afc5760405162461bcd60e51b815260206004820181905260248201527f437265617465323a2062797465636f6465206c656e677468206973207a65726f6044820152606401610557565b8282516020840186f590506001600160a01b038116610b5d5760405162461bcd60e51b815260206004820152601960248201527f437265617465323a204661696c6564206f6e206465706c6f79000000000000006044820152606401610557565b9392505050565b6000604051836040820152846020820152828152600b8101905060ff815360559020949350505050565b600060808284031215610ba057600080fd5b50919050565b80356001600160a01b0381168114610bbd57600080fd5b919050565b60008083601f840112610bd457600080fd5b50813567ffffffffffffffff811115610bec57600080fd5b602083019150836020828501011115610c0457600080fd5b9250929050565b600080600080600060808688031215610c2357600080fd5b853567ffffffffffffffff80821115610c3b57600080fd5b610c4789838a01610b8e565b96506020880135915080821115610c5d57600080fd5b9087019060a0828a031215610c7157600080fd5b819550610c8060408901610ba6565b94506060880135915080821115610c9657600080fd5b50610ca388828901610bc2565b969995985093965092949392505050565b600080600080600060808688031215610ccc57600080fd5b853567ffffffffffffffff80821115610ce457600080fd5b908701906060828a031215610cf857600080fd5b90955060208701359080821115610d0e57600080fd5b610d1a89838a01610b8e565b9550610c8060408901610ba6565b808201808211156107f4577f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b6000808335601e19843603018112610d7957600080fd5b830160208101925035905067ffffffffffffffff811115610d9957600080fd5b803603821315610c0457600080fd5b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b80358015158114610bbd57600080fd5b6080815285356080820152602086013560a08201526000610e0460408801610ba6565b6001600160a01b0380821660c0850152610e2160608a018a610d62565b9250608060e0860152610e3961010086018483610da8565b92505083820360208501528735825280610e5560208a01610ba6565b16602083015250610e696040880188610d62565b60a06040840152610e7e60a084018284610da8565b915050610e8d60608901610dd1565b15156060830152610ea16080890189610d62565b8383036080850152610eb4838284610da8565b9350505050610ece60408401876001600160a01b03169052565b8281036060840152610ee1818587610da8565b98975050505050505050565b60006001600160a01b03808716835280861660208401525060606040830152610f1a606083018486610da8565b9695505050505050565b600060208284031215610f3657600080fd5b6107f182610ba6565b6080815285356080820152602086013560a08201526000610f636040880188610d62565b606060c0850152610f7860e085018284610da8565b915050828103602084015286358152610f946020880188610d62565b60806020840152610fa9608084018284610da8565b915050610fb860408901610dd1565b15156040830152610fcc6060890189610d62565b8383036060850152610eb4838284610da8565b6000808335601e19843603018112610ff657600080fd5b83018035915067ffffffffffffffff82111561101157600080fd5b602001915036819003821315610c0457600080fd5b8183823760009101908152919050565b60006020828403121561104857600080fd5b6107f182610dd1565b60005b8381101561106c578181015183820152602001611054565b50506000910152565b848682376000858201600081528551611092818360208a01611051565b018385823760009301928352509095945050505050565b60208152600082518060208401526110c8816040850160208701611051565b601f01601f19169190910160400192915050565b600085516110ee818460208a01611051565b855190830190611102818360208a01611051565b0183858237600093019283525090949350505050565b6000825161112a818460208701611051565b9190910192915050565b8a815260006001600160a01b03808c16602084015260e0604084015261115e60e084018b8d610da8565b8915156060850152838103608085015261117981898b610da8565b905081871660a085015283810360c0850152611196818688610da8565b9e9d5050505050505050505050505050565b89815260c0602082015260006111c260c083018a8c610da8565b881515604084015282810360608401526111dd81888a610da8565b90506001600160a01b038616608084015282810360a0840152611201818587610da8565b9c9b50505050505050505050505056fea2646970667358221220add0ea42f8f9e02abd8c7da64d0b13eef395e008fa30377a6b79ea444e7d21bb64736f6c63430008110033",
    });
    await lsp23Tx.wait();
    console.log("LSP23Factory deployed");
  }

  if (!isKeyManagerInitDeployed) {
    const data =
      "0xfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeed60806040523480156200001157600080fd5b506200001c62000022565b620000e3565b600054610100900460ff16156200008f5760405162461bcd60e51b815260206004820152602760248201527f496e697469616c697a61626c653a20636f6e747261637420697320696e697469604482015266616c697a696e6760c81b606482015260840160405180910390fd5b60005460ff90811614620000e1576000805460ff191660ff9081179091556040519081527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b565b61436a80620000f36000396000f3fe6080604052600436106100c75760003560e01c8063bf0176ff11610074578063d4b839921161004e578063d4b8399214610210578063de928f1414610238578063ffa1ad741461025857600080fd5b8063bf0176ff146101bb578063c4d66de8146101ce578063d3fc45d3146101f057600080fd5b80634c8a4e74116100a55780634c8a4e741461015a578063a20856a51461016d578063b44581d91461018d57600080fd5b806301ffc9a7146100cc57806309c5eabe146101015780631626ba7e14610121575b600080fd5b3480156100d857600080fd5b506100ec6100e73660046135db565b6102a1565b60405190151581526020015b60405180910390f35b61011461010f366004613647565b610374565b6040516100f891906136d9565b34801561012d57600080fd5b5061014161013c3660046137b1565b610388565b6040516001600160e01b031990911681526020016100f8565b6101146101683660046137f8565b610411565b61018061017b36600461396a565b61042b565b6040516100f89190613a55565b34801561019957600080fd5b506101ad6101a8366004613acc565b61062d565b6040519081526020016100f8565b6101806101c9366004613b1a565b610681565b3480156101da57600080fd5b506101ee6101e9366004613b86565b61080a565b005b3480156101fc57600080fd5b5061014161020b3660046137b1565b61092c565b34801561021c57600080fd5b506002546040516001600160a01b0390911681526020016100f8565b34801561024457600080fd5b50610141610253366004613ba3565b610968565b34801561026457600080fd5b506101146040518060400160405280600681526020017f302e31322e31000000000000000000000000000000000000000000000000000081525081565b60006001600160e01b031982167f23f34c620000000000000000000000000000000000000000000000000000000014806102eb57506001600160e01b03198216630b135d3f60e11b145b8061031f57506001600160e01b031982167f0d6ecac700000000000000000000000000000000000000000000000000000000145b8061035357506001600160e01b031982167f5ac7990800000000000000000000000000000000000000000000000000000000145b8061036e57506301ffc9a760e01b6001600160e01b03198316145b92915050565b6060610381348484610ad2565b9392505050565b60008060006103978585610c05565b909250905060008160048111156103b0576103b0613c28565b146103c857506001600160e01b0319915061036e9050565b6002546103ed9062200000906103e7906001600160a01b031685610c4a565b81161490565b6103ff576001600160e01b0319610408565b630b135d3f60e11b5b95945050505050565b6060610421868686348787610d0b565b9695505050505050565b88516060908814158061043e5750878614155b806104495750858414155b806104545750838214155b1561048b576040517fb4d50d2100000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60008267ffffffffffffffff8111156104a6576104a66136ec565b6040519080825280602002602001820160405280156104d957816020015b60608152602001906001900390816104c45790505b5090506000805b848110156105f357348888838181106104fb576104fb613c3e565b905060200201358361050d9190613c6a565b925082111561053d57604051630c28c92b60e21b8152600481018390523460248201526044015b60405180910390fd5b6105ce8d828151811061055257610552613c3e565b60200260200101518d8d8481811061056c5761056c613c3e565b905060200201358c8c8581811061058557610585613c3e565b905060200201358b8b8681811061059e5761059e613c3e565b905060200201358a8a878181106105b7576105b7613c3e565b90506020028101906105c99190613c7d565b610d0b565b8382815181106105e0576105e0613c3e565b60209081029190910101526001016104e0565b503481101561061e5760405163528c345b60e11b815260048101829052346024820152604401610534565b509a9950505050505050505050565b6001600160a01b03821660009081526001602090815260408083206fffffffffffffffffffffffffffffffff85168452909152812054608083901b6fffffffffffffffffffffffffffffffff191617610381565b60608382146106bc576040517f55a187db00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60008267ffffffffffffffff8111156106d7576106d76136ec565b60405190808252806020026020018201604052801561070a57816020015b60608152602001906001900390816106f55790505b5090506000805b848110156107d3573488888381811061072c5761072c613c3e565b905060200201358361073e9190613c6a565b925082111561076957604051630c28c92b60e21b815260048101839052346024820152604401610534565b6107ae88888381811061077e5761077e613c3e565b9050602002013587878481811061079757610797613c3e565b90506020028101906107a99190613c7d565b610ad2565b8382815181106107c0576107c0613c3e565b6020908102919091010152600101610711565b50348110156107fe5760405163528c345b60e11b815260048101829052346024820152604401610534565b5090505b949350505050565b600054610100900460ff161580801561082a5750600054600160ff909116105b806108445750303b158015610844575060005460ff166001145b6108b65760405162461bcd60e51b815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201527f647920696e697469616c697a65640000000000000000000000000000000000006064820152608401610534565b6000805460ff1916600117905580156108d9576000805461ff0019166101001790555b6108e282610f0d565b8015610928576000805461ff0019169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b5050565b6002546000906001600160a01b0316330361095957336000908152600360205260409020805460ff191690555b5063d3fc45d360e01b92915050565b600080631fc8da4360e21b61097d8486613cc4565b6001600160e01b03191614806109ac5750639790242160e01b6109a08486613cc4565b6001600160e01b031916145b90506001600160a01b0387163303610a6b5760006109cb888389610fec565b90506109db888860008888611059565b6109e58486613cc4565b6001600160e01b03191686886001600160a01b03167fc0a62328f6bf5e3172bb1fcb2019f54b2c523b6a48e3513a2298fbf0150b781e60405160405180910390a48180610a2f5750805b610a405763de928f0160e01b610a62565b7fde928f00000000000000000000000000000000000000000000000000000000005b92505050610421565b6001600160a01b03871660009081526003602052604090205460ff168015610aab57610aab87610aa46001600160a01b038b1682610c4a565b608061147a565b610ab9888860008888611059565b8180610a2f575080610a405763de928f0160e01b610a62565b60606004821015610afa578282604051630d886ef360e21b8152600401610534929190613cf4565b6000631fc8da4360e21b610b0e8486613cc4565b6001600160e01b0319161480610b3d5750639790242160e01b610b318486613cc4565b6001600160e01b031916145b6002549091506001600160a01b03166000610b59828433610fec565b9050610b69823360008989611059565b610b738587613cc4565b6001600160e01b03191687336001600160a01b03167fc0a62328f6bf5e3172bb1fcb2019f54b2c523b6a48e3513a2298fbf0150b781e60405160405180910390a46000610bc28389898961148a565b905081158015610bd0575083155b15610bfa57610bfa836001600160a01b03166000908152600360205260409020805460ff19169055565b979650505050505050565b6000808251604103610c3b5760208301516040840151606085015160001a610c2f87828585611542565b94509450505050610c43565b506000905060025b9250929050565b6000806001600160a01b0384166354f6127f610c8a7f4b80742de2bf82acb36300000000000000000000000000000000000000000000606087901b611606565b6040518263ffffffff1660e01b8152600401610ca891815260200190565b600060405180830381865afa158015610cc5573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610ced9190810190613d23565b90508051602014610d0257506000905061036e565b61080281613d91565b60606004821015610d33578282604051630d886ef360e21b8152600401610534929190613cf4565b6002546001600160a01b03166000610d4f89898989898961166f565b6001600160a01b038116600090815260016020908152604080832060808d901c84529091529020549091506fffffffffffffffffffffffffffffffff891614610dca5780888a6040517fc9bd9eb900000000000000000000000000000000000000000000000000000000815260040161053493929190613db8565b6001600160a01b038116600090815260016020908152604080832060808c901c84529091528120805491610dfd83613de0565b9190505550610e0b876116c7565b6000631fc8da4360e21b610e1f8688613cc4565b6001600160e01b0319161480610e4e5750639790242160e01b610e428688613cc4565b6001600160e01b031916145b90506000610e5d848385610fec565b9050610e6d848460018a8a611059565b610e778688613cc4565b6001600160e01b03191688846001600160a01b03167fc0a62328f6bf5e3172bb1fcb2019f54b2c523b6a48e3513a2298fbf0150b781e60405160405180910390a46000610ec6858a8a8a61148a565b905081158015610ed4575082155b15610efe57610efe856001600160a01b03166000908152600360205260409020805460ff19169055565b9b9a5050505050505050505050565b600054610100900460ff16610f8a5760405162461bcd60e51b815260206004820152602b60248201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960448201527f6e697469616c697a696e670000000000000000000000000000000000000000006064820152608401610534565b6001600160a01b038116610fca576040517ffc85457900000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600280546001600160a01b0319166001600160a01b0392909216919091179055565b6001600160a01b03831660009081526003602052604090205460ff16801561102a5761102582610aa46001600160a01b03871682610c4a565b610381565b82610381576001600160a01b0384166000908152600360205260409020805460ff191660011790559392505050565b600061106e6001600160a01b03871686610c4a565b9050806110b2576040517ff292052a0000000000000000000000000000000000000000000000000000000081526001600160a01b0386166004820152602401610534565b83156110c2576110c2858261177c565b60006110ce8385613cc4565b90507f80dc96f4000000000000000000000000000000000000000000000000000000006001600160e01b0319821601611136576000806111118560048189613df9565b81019061111e91906137b1565b9150915061112f89898685856117e2565b5050611471565b7f686fdbdf000000000000000000000000000000000000000000000000000000006001600160e01b0319821601611195576000806111778560048189613df9565b8101906111849190613e23565b9150915061112f898986858561185e565b7fbb3fd702000000000000000000000000000000000000000000000000000000006001600160e01b03198216016112055760008080806111d8876004818b613df9565b8101906111e59190613ed2565b93509350935093506111fc8b8b88878787876119e1565b50505050611471565b7fce7a7bae000000000000000000000000000000000000000000000000000000006001600160e01b031982160161138a576000808080611248876004818b613df9565b8101906112559190613f90565b93509350935093508251845114158061127057508151835114155b8061127d57508051825114155b156112b4576040517f3ff55f4d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b83516000036112ef576040517fe9ad2b5f00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60005b84518110156113805761136e8c8c8988858151811061131357611313613c3e565b602002602001015188868151811061132d5761132d613c3e565b602002602001015188878151811061134757611347613c3e565b602002602001015188888151811061136157611361613c3e565b60200260200101516119e1565b8061137881613de0565b9150506112f2565b5050505050611471565b6001600160e01b031981167ff2fde38b0000000000000000000000000000000000000000000000000000000014806113eb57506001600160e01b031981167f79ba509700000000000000000000000000000000000000000000000000000000145b8061141f57506001600160e01b031981167f715018a600000000000000000000000000000000000000000000000000000000145b156114335761142e8683611aae565b611471565b6040517f2ba8851c0000000000000000000000000000000000000000000000000000000081526001600160e01b031982166004820152602401610534565b50505050505050565b611485838383611ae3565b505050565b6060600080866001600160a01b0316865a9087876040516114ac92919061408e565b600060405180830381858888f193505050503d80600081146114ea576040519150601f19603f3d011682016040523d82523d6000602084013e6114ef565b606091505b5091509150600061153683836040518060400160405280601e81526020017f4c5350363a206661696c656420657865637574696e67207061796c6f61640000815250611b16565b98975050505050505050565b6000807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a083111561157957506000905060036115fd565b6040805160008082526020820180845289905260ff881692820192909252606081018690526080810185905260019060a0016020604051602081039080840390855afa1580156115cd573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b0381166115f6576000600192509250506115fd565b9150600090505b94509492505050565b604080517fffffffffffffffffffff00000000000000000000000000000000000000000000841660208201526000602a82018190526bffffffffffffffffffffffff198416602c8301529182910160405160208183030381529060405290508061080290613d91565b6000806019468888888888604051602001611690979695949392919061409e565b60408051601f19818403018152919052905060006116ae3083611b2f565b90506116ba818a611b62565b9998505050505050505050565b806000036116d25750565b608081901c8142821115611711576040517ede4b8a00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b806fffffffffffffffffffffffffffffffff1660000361173057505050565b806fffffffffffffffffffffffffffffffff16421115611485576040517f5c53a98c00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b62400000808216146109285760408051631ded6b7360e11b81526001600160a01b03841660048201526024810191909152601260448201527f455845435554455f52454c41595f43414c4c00000000000000000000000000006064820152608401610534565b60006117f086858585611b86565b90506203ffff19810161183f57620200008085160361180f5750611857565b61181d85856204000061147a565b61183a85846118356001600160a01b038a1683611f3d565b611fdd565b611855565b8061184a5750611857565b61185585858361147a565b505b5050505050565b8051825114611899576040517f3bcc897900000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600080835167ffffffffffffffff8111156118b6576118b66136ec565b6040519080825280602002602001820160405280156118df578160200160208202803683370190505b509050600080805b6119258a898984815181106118fe576118fe613c3e565b602002602001015189858151811061191857611918613c3e565b6020026020010151611b86565b91506203ffff19820161193b576001945061197e565b811561194c5761194c89898461147a565b600184828151811061196057611960613c3e565b911515602092830291909101909101528261197a81613de0565b9350505b806001019050865181106118e75784156119d55762020000808916036119a8575050505050611857565b6119b689896204000061147a565b6119d589886119ce6001600160a01b038e1683611f3d565b878761213d565b50505050505050505050565b306001600160a01b03841603611a23576040517fa431b23600000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b83611a365761142e878787868686612381565b6001841480611a455750600284145b15611a5e57811515611a5887878361245d565b50611471565b60038403611a745761142e8787878686866124e2565b60048403611471576040517f80d6ebae00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600180821614610928576000611ac46001612511565b90508281604051631ded6b7360e11b81526004016105349291906140d4565b8082168114611485576000611af782612511565b90508381604051631ded6b7360e11b81526004016105349291906140d4565b60608315611b25575081610381565b610381838361290e565b60008282604051602001611b449291906140f6565b60405160208183030381529060405280519060200120905092915050565b6000806000611b718585610c05565b91509150611b7e81612938565b509392505050565b60007f20cf245f92495cf19acab2659b39f67a000000000000000000000000000000006fffffffffffffffffffffffffffffffff19841601611bdc57600684811614611bd486858584612aa0565b915050610802565b7fb47f8bd21d4100000000000000000000000000000000000000000000000000007fffffffffffff0000000000000000000000000000000000000000000000000000841601611d59576006848116146001600160a01b031984167fb47f8bd21d407d534c9d0000000000000000000000000000000000000000000001611caa578251602014158015611c6e5750825115155b15611c90578383604051631fa4139760e01b8152600401610534929190614154565b8015611ca0575060009050610802565b611bd48685612c8a565b7fb47f8bd21d40c6c59b39000000000000000000000000000000000000000000006001600160a01b0319851601611ce757611bd486858584612cc0565b7fb47f8bd21d407993d6ef000000000000000000000000000000000000000000006001600160a01b0319851601611d2457611bd486858584612d2b565b6040517f0f7d735b00000000000000000000000000000000000000000000000000000000815260048101859052602401610534565b7f0cfc51aec37c55a4d0b1a65c6255c4bf2fbdf6277f3cc0730c45b828b6db8b47831480611db057506001600160a01b031983167f0cfc51aec37c55a4d0b100000000000000000000000000000000000000000000145b15611e0c578151601414158015611dc75750815115155b15611de9578282604051631fa4139760e01b8152600401610534929190614154565b606080851603611dfb57506000610802565b611e058584612d55565b9050610802565b7f311874bf6b2579feef6a000000000000000000000000000000000000000000006001600160a01b0319841601611f33578151601414158015611e5157508151601514155b8015611e5d5750815115155b15611e7f578282604051631fa4139760e01b8152600401610534929190614154565b606083901b6001600160e01b031981167fde928f14000000000000000000000000000000000000000000000000000000001480611ecc57506001600160e01b0319811663d3fc45d360e01b145b15611f155730611edb8461416d565b60601c03611f15576040517f4a9fa8cf00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b601880861603611f29575060009050610802565b611bd48685612ddb565b5062040000610802565b60606001600160a01b0383166354f6127f611f7a7f4b80742de2bf866c29110000000000000000000000000000000000000000000085851b611606565b6040518263ffffffff1660e01b8152600401611f9891815260200190565b600060405180830381865afa158015611fb5573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526103819190810190613d23565b805160000361200a5760405163ed7fa50960e01b81526001600160a01b0384166004820152602401610534565b6000806000805b84518410156121125784848151811061202c5761202c613c3e565b01602001516001600160f81b03191685612047866001613c6a565b8151811061205757612057613c3e565b016020908101516040516001600160f81b031993841692810192909252919091166021820152602201604051602081830303815290604052612098906141a9565b60f01c92508215806120aa5750602083115b156120ca578460405163ae6cbd3760e01b815260040161053491906141f5565b6120d5836020614247565b6120e090600861425a565b8585016022015160001990911b9081169250905085811682036121065750505050505050565b92820160020192612011565b60405163557ae07960e01b81526001600160a01b038816600482015260248101879052604401610534565b825160000361216a5760405163ed7fa50960e01b81526001600160a01b0386166004820152602401610534565b835160008080805b87518410156122fb5787848151811061218d5761218d613c3e565b01602001516001600160f81b031916886121a8866001613c6a565b815181106121b8576121b8613c3e565b016020908101516040516001600160f81b0319938416928101929092529190911660218201526022016040516020818303038152906040526121f9906141a9565b60f01c925082158061220b5750602083115b1561222b578760405163ae6cbd3760e01b815260040161053491906141f5565b612236836020614247565b61224190600861425a565b8885016022015160001990911b9081169250905060005b858110156122ee5787818151811061227257612272613c3e565b60200260200101511561228757600101612258565b82828b838151811061229b5761229b613c3e565b602002602001015116036122e65760018882815181106122bd576122bd613c3e565b91151560209283029190910190910152600180880197879003016122e657505050505050611857565b600101612258565b5092820160020192612172565b60005b858110156123745787818151811061231857612318613c3e565b602002602001015161236c578a8a828151811061233757612337613c3e565b602090810291909101015160405163557ae07960e01b81526001600160a01b0390921660048301526024820152604401610534565b6001016122fe565b5050505050505050505050565b805182158015916101008781161491901590610400808916149084906123a5575082155b156123b7576123b7898961020061147a565b8180156123c2575083155b80156123cc575080155b156123de576123de898961080061147a565b811580156123ea575080155b156123fc576123fc898961080061147a565b831580156124075750805b156124155750505050611855565b81801561241f5750835b80156124285750825b156124365750505050611855565b8080156124405750825b1561244e5750505050611855565b6119d58a8a60008a8a8a612e61565b61246b83836201000061147a565b6101008281161481801561247d575080155b156124dc5760408051631ded6b7360e11b81526001600160a01b03861660048201526024810191909152601360448201527f53555045525f5452414e5346455256414c5545000000000000000000000000006064820152608401610534565b50505050565b6110008481161480156124f55750611855565b612502868661200061147a565b61147187876003878787612e61565b6060600019820161255557505060408051808201909152601181527f5452414e534645524f574e455253484950000000000000000000000000000000602082015290565b600319820161259757505060408051808201909152600f81527f454449545045524d495353494f4e530000000000000000000000000000000000602082015290565b60011982016125d957505060408051808201909152600d81527f414444434f4e54524f4c4c455200000000000000000000000000000000000000602082015290565b600719820161261b57505060408051808201909152600d81527f414444455854454e53494f4e5300000000000000000000000000000000000000602082015290565b600f19820161265d57505060408051808201909152601081527f4348414e4745455854454e53494f4e5300000000000000000000000000000000602082015290565b601f19820161269f57505060408051808201909152601c81527f414444554e4956455253414c524543454956455244454c454741544500000000602082015290565b603f1982016126e157505060408051808201909152601f81527f4348414e4745554e4956455253414c524543454956455244454c454741544500602082015290565b607f19820161272357505060408051808201909152600a81527f5245454e5452414e435900000000000000000000000000000000000000000000602082015290565b6203ffff19820161276757505060408051808201909152600781527f5345544441544100000000000000000000000000000000000000000000000000602082015290565b6107ff1982016127aa57505060408051808201909152600481527f43414c4c00000000000000000000000000000000000000000000000000000000602082015290565b611fff1982016127ed57505060408051808201909152600a81527f53544154494343414c4c00000000000000000000000000000000000000000000602082015290565b617fff19820161283057505060408051808201909152600c81527f44454c454741544543414c4c0000000000000000000000000000000000000000602082015290565b61ffff19820161287357505060408051808201909152600681527f4445504c4f590000000000000000000000000000000000000000000000000000602082015290565b6101ff1982016128b657505060408051808201909152600d81527f5452414e5346455256414c554500000000000000000000000000000000000000602082015290565b621fffff1982016128fa57505060408051808201909152600481527f5349474e00000000000000000000000000000000000000000000000000000000602082015290565b505060408051602081019091526000815290565b81511561291e5781518083602001fd5b8060405162461bcd60e51b815260040161053491906136d9565b600081600481111561294c5761294c613c28565b036129545750565b600181600481111561296857612968613c28565b036129b55760405162461bcd60e51b815260206004820152601860248201527f45434453413a20696e76616c6964207369676e617475726500000000000000006044820152606401610534565b60028160048111156129c9576129c9613c28565b03612a165760405162461bcd60e51b815260206004820152601f60248201527f45434453413a20696e76616c6964207369676e6174757265206c656e677468006044820152606401610534565b6003816004811115612a2a57612a2a613c28565b03612a9d5760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202773272076616c60448201527f75650000000000000000000000000000000000000000000000000000000000006064820152608401610534565b50565b60007f20cf245f92495cf19acab2659b39f679e0f76aba35a7394b241ce5a0cc734f1d8401612bc3578251601014158015612adb5750825115155b15612afd578383604051631fa4139760e01b8152600401610534929190614154565b8115612b0b57506000610802565b6000612b1684614271565b60801c9050856001600160a01b03166354f6127f866040518263ffffffff1660e01b8152600401612b4991815260200190565b600060405180830381865afa158015612b66573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052612b8e9190810190613d23565b612b9790614271565b60801c6fffffffffffffffffffffffffffffffff821611612bb9576004611bd4565b6002915050610802565b825115801590612bd557508251601414155b15612bf7578383604051631fa4139760e01b8152600401610534929190614154565b8115612c0557506000610802565b6040516354f6127f60e01b8152600481018590526001600160a01b038616906354f6127f90602401600060405180830381865afa158015612c4a573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052612c729190810190613d23565b5115612c7f576004610408565b600295945050505050565b60006001600160a01b03808316908290612ca690861683610c4a565b90508015612cb5576004610408565b506002949350505050565b6000612ccb8361303d565b612cea578260405163187e77ab60e01b815260040161053491906136d9565b8115612cf857506000610802565b6001600160a01b0380851690600090612d1390881683610c4a565b14612d1f576004610421565b60029695505050505050565b6000612d3683613133565b612cea578260405163ae6cbd3760e01b815260040161053491906142ae565b6040516354f6127f60e01b8152600481018290526000906001600160a01b038416906354f6127f90602401600060405180830381865afa158015612d9d573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052612dc59190810190613d23565b5115612dd2576040610381565b50602092915050565b6040516354f6127f60e01b8152600481018290526000906001600160a01b038416906354f6127f90602401600060405180830381865afa158015612e23573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052612e4b9190810190613d23565b5115612e58576010610381565b50600892915050565b6000612e766001600160a01b03881687613219565b90508051600003612ebe576040517f6cb605870000000000000000000000000000000000000000000000000000000081526001600160a01b0387166004820152602401610534565b6000612ecb868585613256565b905060005b8251811015612fdb578251612ee6826022613c6a565b1115612f07578260405163187e77ab60e01b815260040161053491906136d9565b6000612f1f84612f18846002613c6a565b6020613332565b905063ffffffff196020612f3283613d91565b63ffffffff19911b1603612f7d576040517f6fd203c50000000000000000000000000000000000000000000000000000000081526001600160a01b038a166004820152602401610534565b612f87818461345a565b8015612f985750612f988188613481565b8015612fa95750612fa981886134c4565b8015612fba5750612fba81866134fc565b15612fc85750505050611855565b50612fd4602282613c6a565b9050612ed0565b508685612fe785614300565b6040517f45147bce0000000000000000000000000000000000000000000000000000000081526001600160a01b0393841660048201529290911660248301526001600160e01b0319166044820152606401610534565b6000805b8251811015613119578251613057826001613c6a565b106130655750600092915050565b600083828151811061307957613079613c3e565b01602001516001600160f81b03191684613094846001613c6a565b815181106130a4576130a4613c3e565b016020908101516040516001600160f81b0319938416928101929092529190911660218201526022016040516020818303038152906040526130e5906141a9565b60f01c9050602081146130fc575060009392505050565b613107816002613c6a565b6131119083613c6a565b915050613041565b8251810361312a5750600192915050565b50600092915050565b6000805b825181101561311957825161314d826001613c6a565b1061315b5750600092915050565b600083828151811061316f5761316f613c3e565b01602001516001600160f81b0319168461318a846001613c6a565b8151811061319a5761319a613c3e565b016020908101516040516001600160f81b0319938416928101929092529190911660218201526022016040516020818303038152906040526131db906141a9565b60f01c90508015806131ed5750602081115b156131fc575060009392505050565b613207816002613c6a565b6132119083613c6a565b915050613137565b60606001600160a01b0383166354f6127f611f7a7f4b80742de2bf393a64c70000000000000000000000000000000000000000000085851b611606565b6000821561327e577c0100000000000000000000000000000000000000000000000000000000175b81511580159060009082613290575084155b9050818061329b5750805b1561332957856132cd577c02000000000000000000000000000000000000000000000000000000009290921791613329565b600386036132fd577c04000000000000000000000000000000000000000000000000000000009290921791613329565b60048603613329577c080000000000000000000000000000000000000000000000000000000092909217915b50509392505050565b60608161334081601f613c6a565b101561338e5760405162461bcd60e51b815260206004820152600e60248201527f736c6963655f6f766572666c6f770000000000000000000000000000000000006044820152606401610534565b6133988284613c6a565b845110156133e85760405162461bcd60e51b815260206004820152601160248201527f736c6963655f6f75744f66426f756e64730000000000000000000000000000006044820152606401610534565b6060821580156134075760405191506000825260208201604052613451565b6040519150601f8416801560200281840101858101878315602002848b0101015b81831015613440578051835260209283019201613428565b5050858452601f01601f1916604052505b50949350505050565b60008061346684614300565b83166001600160e01b03199081169084161491505092915050565b600080602061348f85613d91565b901b60601c90506001600160a01b038114806108025750806001600160a01b0316836001600160a01b03161491505092915050565b60008060c06134d285613d91565b901b90506001600160e01b0319808216148061080257506108026001600160a01b03841682613556565b60008060e061350a85613d91565b8451911b915060041115600061351f85614300565b90506001600160e01b03198381161480610421575081801561042157506001600160e01b0319818116908416149695505050505050565b604080516001600160e01b03198316602480830191909152825180830390910181526044909101909152602080820180516001600160e01b03166301ffc9a760e01b178152825160009392849283928392918391908a617530fa92503d915060005190508280156135c8575060208210155b8015610bfa575015159695505050505050565b6000602082840312156135ed57600080fd5b81356001600160e01b03198116811461038157600080fd5b60008083601f84011261361757600080fd5b50813567ffffffffffffffff81111561362f57600080fd5b602083019150836020828501011115610c4357600080fd5b6000806020838503121561365a57600080fd5b823567ffffffffffffffff81111561367157600080fd5b61367d85828601613605565b90969095509350505050565b60005b838110156136a457818101518382015260200161368c565b50506000910152565b600081518084526136c5816020860160208601613689565b601f01601f19169290920160200192915050565b60208152600061038160208301846136ad565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff8111828210171561372b5761372b6136ec565b604052919050565b600067ffffffffffffffff82111561374d5761374d6136ec565b50601f01601f191660200190565b600082601f83011261376c57600080fd5b813561377f61377a82613733565b613702565b81815284602083860101111561379457600080fd5b816020850160208301376000918101602001919091529392505050565b600080604083850312156137c457600080fd5b82359150602083013567ffffffffffffffff8111156137e257600080fd5b6137ee8582860161375b565b9150509250929050565b60008060008060006080868803121561381057600080fd5b853567ffffffffffffffff8082111561382857600080fd5b61383489838a0161375b565b96506020880135955060408801359450606088013591508082111561385857600080fd5b5061386588828901613605565b969995985093965092949392505050565b600067ffffffffffffffff821115613890576138906136ec565b5060051b60200190565b600082601f8301126138ab57600080fd5b813560206138bb61377a83613876565b82815260059290921b840181019181810190868411156138da57600080fd5b8286015b8481101561391a57803567ffffffffffffffff8111156138fe5760008081fd5b61390c8986838b010161375b565b8452509183019183016138de565b509695505050505050565b60008083601f84011261393757600080fd5b50813567ffffffffffffffff81111561394f57600080fd5b6020830191508360208260051b8501011115610c4357600080fd5b600080600080600080600080600060a08a8c03121561398857600080fd5b893567ffffffffffffffff808211156139a057600080fd5b6139ac8d838e0161389a565b9a5060208c01359150808211156139c257600080fd5b6139ce8d838e01613925565b909a50985060408c01359150808211156139e757600080fd5b6139f38d838e01613925565b909850965060608c0135915080821115613a0c57600080fd5b613a188d838e01613925565b909650945060808c0135915080821115613a3157600080fd5b50613a3e8c828d01613925565b915080935050809150509295985092959850929598565b6000602080830181845280855180835260408601915060408160051b870101925083870160005b82811015613aaa57603f19888603018452613a988583516136ad565b94509285019290850190600101613a7c565b5092979650505050505050565b6001600160a01b0381168114612a9d57600080fd5b60008060408385031215613adf57600080fd5b8235613aea81613ab7565b915060208301356fffffffffffffffffffffffffffffffff81168114613b0f57600080fd5b809150509250929050565b60008060008060408587031215613b3057600080fd5b843567ffffffffffffffff80821115613b4857600080fd5b613b5488838901613925565b90965094506020870135915080821115613b6d57600080fd5b50613b7a87828801613925565b95989497509550505050565b600060208284031215613b9857600080fd5b813561038181613ab7565b60008060008060008060a08789031215613bbc57600080fd5b8635613bc781613ab7565b95506020870135613bd781613ab7565b94506040870135613be781613ab7565b935060608701359250608087013567ffffffffffffffff811115613c0a57600080fd5b613c1689828a01613605565b979a9699509497509295939492505050565b634e487b7160e01b600052602160045260246000fd5b634e487b7160e01b600052603260045260246000fd5b634e487b7160e01b600052601160045260246000fd5b8082018082111561036e5761036e613c54565b6000808335601e19843603018112613c9457600080fd5b83018035915067ffffffffffffffff821115613caf57600080fd5b602001915036819003821315610c4357600080fd5b6001600160e01b03198135818116916004851015613cec5780818660040360031b1b83161692505b505092915050565b60208152816020820152818360408301376000818301604090810191909152601f909201601f19160101919050565b600060208284031215613d3557600080fd5b815167ffffffffffffffff811115613d4c57600080fd5b8201601f81018413613d5d57600080fd5b8051613d6b61377a82613733565b818152856020838501011115613d8057600080fd5b610408826020830160208601613689565b80516020808301519190811015613db2576000198160200360031b1b821691505b50919050565b6001600160a01b038416815282602082015260606040820152600061040860608301846136ad565b600060018201613df257613df2613c54565b5060010190565b60008085851115613e0957600080fd5b83861115613e1657600080fd5b5050820193919092039150565b60008060408385031215613e3657600080fd5b823567ffffffffffffffff80821115613e4e57600080fd5b818501915085601f830112613e6257600080fd5b81356020613e7261377a83613876565b82815260059290921b84018101918181019089841115613e9157600080fd5b948201945b83861015613eaf57853582529482019490820190613e96565b96505086013592505080821115613ec557600080fd5b506137ee8582860161389a565b60008060008060808587031215613ee857600080fd5b843593506020850135613efa81613ab7565b925060408501359150606085013567ffffffffffffffff811115613f1d57600080fd5b613f298782880161375b565b91505092959194509250565b600082601f830112613f4657600080fd5b81356020613f5661377a83613876565b82815260059290921b84018101918181019086841115613f7557600080fd5b8286015b8481101561391a5780358352918301918301613f79565b60008060008060808587031215613fa657600080fd5b843567ffffffffffffffff80821115613fbe57600080fd5b613fca88838901613f35565b9550602091508187013581811115613fe157600080fd5b8701601f81018913613ff257600080fd5b803561400061377a82613876565b81815260059190911b8201840190848101908b83111561401f57600080fd5b928501925b8284101561404657833561403781613ab7565b82529285019290850190614024565b9750505050604087013591508082111561405f57600080fd5b61406b88838901613f35565b9350606087013591508082111561408157600080fd5b50613f298782880161389a565b8183823760009101908152919050565b878152866020820152856040820152846060820152836080820152818360a08301376000910160a0019081529695505050505050565b6001600160a01b038316815260406020820152600061080260408301846136ad565b7f190000000000000000000000000000000000000000000000000000000000000081526bffffffffffffffffffffffff198360601b16600282015260008251614146816016850160208701613689565b919091016016019392505050565b82815260406020820152600061080260408301846136ad565b805160208201516bffffffffffffffffffffffff1980821692919060148310156141a15780818460140360031b1b83161693505b505050919050565b6000815160208301517fffff000000000000000000000000000000000000000000000000000000000000808216935060028310156141a15760029290920360031b82901b161692915050565b60408152600061420860408301846136ad565b8281036020840152601c81527f636f756c646e2774204445434f44452066726f6d2073746f726167650000000060208201526040810191505092915050565b8181038181111561036e5761036e613c54565b808202811582820484141761036e5761036e613c54565b6000815160208301516fffffffffffffffffffffffffffffffff19808216935060108310156141a15760109290920360031b82901b161692915050565b6040815260006142c160408301846136ad565b8281036020840152602081527f636f756c646e27742056414c49444154452074686520646174612076616c756560208201526040810191505092915050565b6000815160208301516001600160e01b0319808216935060048310156141a15760049290920360031b82901b16169291505056fea2646970667358221220d65337cb391a881b1fab74e466126911cf099aa9898f3d8165664929e15e0a4d64736f6c63430008110033";
    const keyManagerTx = await signer.sendTransaction({
      to: NICK_FACTORY_ADDRESS,
      data,
    });
    await keyManagerTx.wait();
    console.log("KeyManagerInit deployed");
  }

  if (!isUPInitDeployed) {
    const data =
      "0x12a6712f113536d8b01d99f72ce168c7e10901240d73e80eeb821d01aa4c2b1a60806040523480156200001157600080fd5b506200001c6200002c565b620000266200002c565b620000ed565b600054610100900460ff1615620000995760405162461bcd60e51b815260206004820152602760248201527f496e697469616c697a61626c653a20636f6e747261637420697320696e697469604482015266616c697a696e6760c81b606482015260840160405180910390fd5b60005460ff90811614620000eb576000805460ff191660ff9081179091556040519081527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b565b61497980620000fd6000396000f3fe6080604052600436106101635760003560e01c8063715018a6116100c0578063c4d66de811610074578063e30c397811610059578063e30c397814610451578063ead3fbdf1461020d578063f2fde38b1461047c5761019e565b8063c4d66de81461041e578063dedff9c6146104315761019e565b80637f23690c116100a55780637f23690c146103a65780638da5cb5b146103b9578063979024211461040b5761019e565b8063715018a61461037c57806379ba5097146103915761019e565b806344c028fe1161011757806354f6127f116100fc57806354f6127f146103295780636963d438146103495780636bb56a14146103695761019e565b806344c028fe146102f65780634f04d60a146103165761019e565b80631626ba7e116101485780631626ba7e1461026557806328c4d14e146102b657806331858452146102d65761019e565b806301bfba611461020d57806301ffc9a7146102355761019e565b3661019e57341561019c57604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b005b600036606034156101d757604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b60043610156101f55750604080516020810190915260008152610202565b6101ff838361049c565b90505b915050805190602001f35b34801561021957600080fd5b5061022260c881565b6040519081526020015b60405180910390f35b34801561024157600080fd5b50610255610250366004613a93565b610677565b604051901515815260200161022c565b34801561027157600080fd5b50610285610280366004613bca565b61080c565b6040517fffffffff00000000000000000000000000000000000000000000000000000000909116815260200161022c565b3480156102c257600080fd5b5061019c6102d1366004613c7c565b610ac3565b6102e96102e4366004613de7565b610c2a565b60405161022c9190613fb2565b610309610304366004613fc5565b610cf4565b60405161022c919061401a565b61019c61032436600461402d565b610d95565b34801561033557600080fd5b506103096103443660046140a1565b610f19565b34801561035557600080fd5b506102e96103643660046140ba565b610f24565b61030961037736600461412f565b61109a565b34801561038857600080fd5b5061019c6112a2565b34801561039d57600080fd5b5061019c6113a7565b61019c6103b4366004613bca565b6114b1565b3480156103c557600080fd5b5060005462010000900473ffffffffffffffffffffffffffffffffffffffff165b60405173ffffffffffffffffffffffffffffffffffffffff909116815260200161022c565b61019c61041936600461417b565b611552565b61019c61042c3660046141d5565b611681565b34801561043d57600080fd5b506102e961044c3660046141f0565b611815565b34801561045d57600080fd5b5060035473ffffffffffffffffffffffffffffffffffffffff166103e6565b34801561048857600080fd5b5061019c6104973660046141d5565b6118c0565b606060006104cd6000357fffffffff0000000000000000000000000000000000000000000000000000000016611b4f565b90506000357fffffffff0000000000000000000000000000000000000000000000000000000016158015610515575073ffffffffffffffffffffffffffffffffffffffff8116155b15610530575050604080516020810190915260008152610671565b73ffffffffffffffffffffffffffffffffffffffff81166105a8576040517fbb370b2b0000000000000000000000000000000000000000000000000000000081527fffffffff000000000000000000000000000000000000000000000000000000006000351660048201526024015b60405180910390fd5b6000808273ffffffffffffffffffffffffffffffffffffffff16868633346040516020016105d99493929190614225565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529082905261061191614268565b6000604051808303816000865af19150503d806000811461064e576040519150601f19603f3d011682016040523d82523d6000602084013e610653565b606091505b50915091508115610668579250610671915050565b80518060208301fd5b92915050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082167f1626ba7e00000000000000000000000000000000000000000000000000000000148061070a57507fffffffff0000000000000000000000000000000000000000000000000000000082167f24871b3d00000000000000000000000000000000000000000000000000000000145b8061075657507fffffffff0000000000000000000000000000000000000000000000000000000082167f6bb56a1400000000000000000000000000000000000000000000000000000000145b806107a257507fffffffff0000000000000000000000000000000000000000000000000000000082167f94be599900000000000000000000000000000000000000000000000000000000145b806107ee57507fffffffff0000000000000000000000000000000000000000000000000000000082167f1a0eb6a500000000000000000000000000000000000000000000000000000000145b806107fd57506107fd82611bbf565b80610671575061067182611c15565b6000805462010000900473ffffffffffffffffffffffffffffffffffffffff16803b156109e0576000808273ffffffffffffffffffffffffffffffffffffffff16631626ba7e60e01b8787604051602401610868929190614284565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529181526020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff000000000000000000000000000000000000000000000000000000009094169390931790925290516108f19190614268565b600060405180830381855afa9150503d806000811461092c576040519150601f19603f3d011682016040523d82523d6000602084013e610931565b606091505b50915091506000828015610946575081516020145b8015610986575081517f1626ba7e0000000000000000000000000000000000000000000000000000000090610984908401602090810190850161429d565b145b9050806109b3577fffffffff000000000000000000000000000000000000000000000000000000006109d5565b7f1626ba7e000000000000000000000000000000000000000000000000000000005b945050505050610671565b6000806109ed8686611c78565b90925090506000816004811115610a0657610a066142b6565b14610a3757507fffffffff000000000000000000000000000000000000000000000000000000009250610671915050565b8273ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff1614610a90577fffffffff00000000000000000000000000000000000000000000000000000000610ab2565b7f1626ba7e000000000000000000000000000000000000000000000000000000005b9350505050610671565b5092915050565b600080610ad28385018561417b565b915091508573ffffffffffffffffffffffffffffffffffffffff166344c028fe600430600086868b604051602401610b0c939291906142e5565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529181526020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167f4f04d60a000000000000000000000000000000000000000000000000000000001790525160e086901b7fffffffff00000000000000000000000000000000000000000000000000000000168152610bbc949392919060040161435a565b6000604051808303816000875af1158015610bdb573d6000803e3d6000fd5b505050506040513d6000823e601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0168201604052610c219190810190614395565b50505050505050565b60603415610c6057604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b60005462010000900473ffffffffffffffffffffffffffffffffffffffff1633819003610c9b57610c9386868686611cbd565b915050610cec565b6000610ca682611e4d565b90506000610cb688888888611cbd565b90508115610ce757610ce78382604051602001610cd39190613fb2565b604051602081830303815290604052612060565b925050505b949350505050565b60603415610d2a57604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b60005462010000900473ffffffffffffffffffffffffffffffffffffffff1633819003610d5d57610c9386868686612233565b6000610d6882611e4d565b90506000610d7888888888612233565b90508115610ce757610ce78382604051602001610cd3919061401a565b60005462010000900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610eba576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152606860248201527f556e6976657273616c50726f66696c65496e6974506f73744465706c6f796d6560448201527f6e744d6f64756c653a2073657444617461416e645472616e736665724f776e6560648201527f7273686970206f6e6c7920616c6c6f776564207468726f7567682064656c656760848201527f6174652063616c6c00000000000000000000000000000000000000000000000060a482015260c40161059f565b60005b8351811015610f0a57610f02848281518110610edb57610edb614403565b6020026020010151848381518110610ef557610ef5614403565b60200260200101516123d5565b600101610ebd565b50610f1481612449565b505050565b6060610671826124ef565b60608167ffffffffffffffff811115610f3f57610f3f613ab0565b604051908082528060200260200182016040528015610f7257816020015b6060815260200190600190039081610f5d5790505b50905060005b82811015610abc5760008030868685818110610f9657610f96614403565b9050602002810190610fa89190614432565b604051610fb6929190614497565b600060405180830381855af49150503d8060008114610ff1576040519150601f19603f3d011682016040523d82523d6000602084013e610ff6565b606091505b509150915081611072578051156110105780518082602001fd5b6040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601960248201527f4c5350303a20626174636843616c6c7320726576657274656400000000000000604482015260640161059f565b8084848151811061108557611085614403565b60209081029190910101525050600101610f78565b606034156110d057604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b60006110fb7f0cfc51aec37c55a4d0b1a65c6255c4bf2fbdf6277f3cc0730c45b828b6db8b476124ef565b905060606014825110611170576000611113836144a7565b60601c9050611142817f6bb56a1400000000000000000000000000000000000000000000000000000000612591565b1561116e5761116b73ffffffffffffffffffffffffffffffffffffffff82168888883334612660565b91505b505b600061119c7f0cfc51aec37c55a4d0b10000000000000000000000000000000000000000000088612800565b905060006111a9826124ef565b90506060601482511061121e5760006111c1836144a7565b60601c90506111f0817f6bb56a1400000000000000000000000000000000000000000000000000000000612591565b1561121c5761121973ffffffffffffffffffffffffffffffffffffffff82168b8b8b3334612660565b91505b505b83816040516020016112319291906144f7565b604051602081830303815290604052955088343373ffffffffffffffffffffffffffffffffffffffff167f9c3ba68eb5742b8e3961aea0afc7371a71bf433c8a67a831803b64c064a178c28b8b8b60405161128e93929190614565565b60405180910390a450505050509392505050565b60005462010000900473ffffffffffffffffffffffffffffffffffffffff16338190036112d4576112d161287c565b50565b60006112df82611e4d565b9050600061130960005473ffffffffffffffffffffffffffffffffffffffff620100009091041690565b905061131361287c565b60005462010000900473ffffffffffffffffffffffffffffffffffffffff16611388576040805160208101909152600081526113889073ffffffffffffffffffffffffffffffffffffffff8316907fa4e59c931d14f7c8a7a35027f92ee40b5f2886b9fdcdb78f30bc5ecce5a2f814906129b8565b8115610f1457610f148360405180602001604052806000815250612060565b60035474010000000000000000000000000000000000000000900460ff16156113fc576040517f5758dd0700000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60005462010000900473ffffffffffffffffffffffffffffffffffffffff16611423612aa0565b6040805160208101909152600081526114759073ffffffffffffffffffffffffffffffffffffffff8316907fa4e59c931d14f7c8a7a35027f92ee40b5f2886b9fdcdb78f30bc5ecce5a2f814906129b8565b6040805160208101909152600081526112d19033907fceca317f109c43507871523e82dc2a3cc64dfa18f12da0b6db14f6e23f995538906129b8565b34156114e557604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b60005462010000900473ffffffffffffffffffffffffffffffffffffffff163381900361151657610f1483836123d5565b600061152182611e4d565b905061152d84846123d5565b801561154c5761154c8260405180602001604052806000815250612060565b50505050565b341561158657604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b80518251146115c1576040517f3bcc897900000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b60005462010000900473ffffffffffffffffffffffffffffffffffffffff16338190036116115760005b835181101561154c57611609848281518110610edb57610edb614403565b6001016115eb565b600061161c82611e4d565b905060005b84518110156116615761165985828151811061163f5761163f614403565b6020026020010151858381518110610ef557610ef5614403565b600101611621565b50801561154c5761154c8260405180602001604052806000815250612060565b600054610100900460ff16158080156116a15750600054600160ff909116105b806116bb5750303b1580156116bb575060005460ff166001145b611747576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602e60248201527f496e697469616c697a61626c653a20636f6e747261637420697320616c72656160448201527f647920696e697469616c697a6564000000000000000000000000000000000000606482015260840161059f565b600080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0016600117905580156117a557600080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00ff166101001790555b6117ae82612b7a565b801561181157600080547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00ff169055604051600181527f7f26b83ff96e1f2b6a682f133852f6798a09c465da95921460cefb38474024989060200160405180910390a15b5050565b6060815167ffffffffffffffff81111561183157611831613ab0565b60405190808252806020026020018201604052801561186457816020015b606081526020019060019003908161184f5790505b50905060005b82518110156118ba5761189583828151811061188857611888614403565b60200260200101516124ef565b8282815181106118a7576118a7614403565b602090810291909101015260010161186a565b50919050565b60005462010000900473ffffffffffffffffffffffffffffffffffffffff1633819003611a0757600380547fffffffffffffffffffffff00ffffffffffffffffffffffffffffffffffffffff167401000000000000000000000000000000000000000017905561192f82612c7c565b8173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f38d16b8cac22d99fc7c124b9cd0de2d3fa1faef420bfe791d8c362d765e2270060405160405180910390a36040805160208101909152600081526119db9073ffffffffffffffffffffffffffffffffffffffff8416907fe17117c9d2665d1dbeb479ed8058bbebde3c50ac50e2e65619f60006caac6926906129b8565b600380547fffffffffffffffffffffff00ffffffffffffffffffffffffffffffffffffffff1690555050565b6000611a1282611e4d565b600380547fffffffffffffffffffffff00ffffffffffffffffffffffffffffffffffffffff16740100000000000000000000000000000000000000001790559050611a5c83612c7c565b8273ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff167f38d16b8cac22d99fc7c124b9cd0de2d3fa1faef420bfe791d8c362d765e2270060405160405180910390a3604080516020810190915260008152611b089073ffffffffffffffffffffffffffffffffffffffff8516907fe17117c9d2665d1dbeb479ed8058bbebde3c50ac50e2e65619f60006caac6926906129b8565b600380547fffffffffffffffffffffff00ffffffffffffffffffffffffffffffffffffffff1690558015610f1457610f148260405180602001604052806000815250612060565b600080611b9e7fcee78b4094da86011096000000000000000000000000000000000000000000007fffffffff000000000000000000000000000000000000000000000000000000008516612800565b90506000611bab826124ef565b611bb4906144a7565b60601c949350505050565b60007fffffffff0000000000000000000000000000000000000000000000000000000082167fa918fa6b000000000000000000000000000000000000000000000000000000001480610671575061067182612d17565b600080611c417f01ffc9a700000000000000000000000000000000000000000000000000000000611b4f565b905073ffffffffffffffffffffffffffffffffffffffff8116611c675750600092915050565b611c718184612591565b9392505050565b6000808251604103611cae5760208301516040840151606085015160001a611ca287828585612d6d565b94509450505050611cb6565b506000905060025b9250929050565b606083518551141580611cde575082518451141580611cde57508151835114155b15611d15576040517f3ff55f4d00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8451600003611d50576040517fe9ad2b5f00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6000855167ffffffffffffffff811115611d6c57611d6c613ab0565b604051908082528060200260200182016040528015611d9f57816020015b6060815260200190600190039081611d8a5790505b50905060005b8651811015611e4357611e1e878281518110611dc357611dc3614403565b6020026020010151878381518110611ddd57611ddd614403565b6020026020010151878481518110611df757611df7614403565b6020026020010151878581518110611e1157611e11614403565b6020026020010151612233565b828281518110611e3057611e30614403565b6020908102919091010152600101611da5565b5095945050505050565b60008060008373ffffffffffffffffffffffffffffffffffffffff16639bf04b1160e01b3334600036604051602401611e89949392919061458b565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529181526020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff00000000000000000000000000000000000000000000000000000000909416939093179092529051611f129190614268565b6000604051808303816000865af19150503d8060008114611f4f576040519150601f19603f3d011682016040523d82523d6000602084013e611f54565b606091505b5091509150611f6560008383612e5c565b600081806020019051810190611f7b91906145c1565b90507fffffff000000000000000000000000000000000000000000000000000000000081167f9bf04b000000000000000000000000000000000000000000000000000000000014611ffd576000826040517fd088ec4000000000000000000000000000000000000000000000000000000000815260040161059f9291906145de565b7f01000000000000000000000000000000000000000000000000000000000000007fff00000000000000000000000000000000000000000000000000000000000000600383901a60f81b1614612054576000612057565b60015b95945050505050565b6000808373ffffffffffffffffffffffffffffffffffffffff1663d3fc45d360e01b333460003660405160200161209a94939291906145f9565b60405160208183030381529060405280519060200120856040516024016120c2929190614284565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08184030181529181526020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff0000000000000000000000000000000000000000000000000000000090941693909317909252905161214b9190614268565b6000604051808303816000865af19150503d8060008114612188576040519150601f19603f3d011682016040523d82523d6000602084013e61218d565b606091505b509150915061219e60018383612e5c565b80517fd3fc45d300000000000000000000000000000000000000000000000000000000906121d590830160209081019084016145c1565b7fffffffff00000000000000000000000000000000000000000000000000000000161461154c576001816040517fd088ec4000000000000000000000000000000000000000000000000000000000815260040161059f9291906145de565b60608461224c57612245848484612ee5565b9050610cec565b600185036122ac5773ffffffffffffffffffffffffffffffffffffffff8416156122a2576040517f3041824a00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b612245838361305c565b6002850361230c5773ffffffffffffffffffffffffffffffffffffffff841615612302576040517f3041824a00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b61224583836131d5565b6003850361235657821561234c576040517f72f2bc6a00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b61224584836132f8565b600485036123a0578215612396576040517f5ac8313500000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b6122458483613420565b6040517f7583b3bc0000000000000000000000000000000000000000000000000000000081526004810186905260240161059f565b60008281526001602052604090206123ed82826146da565b50817fece574603820d07bc9b91f2a932baadf4628aabcb8afba49776529c14a6104b26101008351111561242e576124298360006101006134fe565b612430565b825b60405161243d919061401a565b60405180910390a25050565b60005473ffffffffffffffffffffffffffffffffffffffff8281166201000090920416146112d1576000805473ffffffffffffffffffffffffffffffffffffffff838116620100008181027fffffffffffffffffffff0000000000000000000000000000000000000000ffff851617855560405193049190911692909183917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a35050565b600081815260016020526040902080546060919061250c9061463f565b80601f01602080910402602001604051908101604052809291908181526020018280546125389061463f565b80156125855780601f1061255a57610100808354040283529160200191612585565b820191906000526020600020905b81548152906001019060200180831161256857829003601f168201915b50505050509050919050565b604080517fffffffff000000000000000000000000000000000000000000000000000000008316602480830191909152825180830390910181526044909101909152602080820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167f01ffc9a700000000000000000000000000000000000000000000000000000000178152825160009392849283928392918391908a617530fa92503d91506000519050828015612649575060208210155b80156126555750600081115b979650505050505050565b60606000636bb56a1460e01b878787604051602401612681939291906147f4565b604080517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0818403018152918152602080830180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff167fffffffff00000000000000000000000000000000000000000000000000000000909516949094179093525161270e92879187910161480e565b60405160208183030381529060405290506000808973ffffffffffffffffffffffffffffffffffffffff16836040516127479190614268565b6000604051808303816000865af19150503d8060008114612784576040519150601f19603f3d011682016040523d82523d6000602084013e612789565b606091505b50915091506127ce82826040518060400160405280602081526020017f43616c6c20746f20756e6976657273616c5265636569766572206661696c6564815250613678565b5080516000036127de57806127f2565b808060200190518101906127f29190614395565b9a9950505050505050505050565b604080517fffffffffffffffffffff00000000000000000000000000000000000000000000841660208201526000602a82018190527fffffffffffffffffffffffffffffffffffffffff0000000000000000000000008416602c83015291829101604051602081830303815290604052905080610cec90614860565b60025443906000906128909060c8906148d1565b9050600061289f60c8836148d1565b9050808311806128af5750600254155b1561290f576002839055600380547fffffffffffffffffffffffff00000000000000000000000000000000000000001690556040517f81b7f830f1f0084db6497c486cbe6974c86488dcc4e3738eab94ab6d6b1653e790600090a1505050565b81831015612953576040517f8b9bf507000000000000000000000000000000000000000000000000000000008152600481018390526024810182905260440161059f565b61295d6000612449565b60006002819055600380547fffffffffffffffffffffffff00000000000000000000000000000000000000001690556040517fd1f66c3d2bc1993a86be5e3d33709d98f0442381befcedd29f578b9b2506b1ce9190a1505050565b6129e2837f6bb56a1400000000000000000000000000000000000000000000000000000000612591565b15610f14576040517f6bb56a1400000000000000000000000000000000000000000000000000000000815273ffffffffffffffffffffffffffffffffffffffff841690636bb56a1490612a3b9085908590600401614284565b6000604051808303816000875af1158015612a5a573d6000803e3d6000fd5b505050506040513d6000823e601f3d9081017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016820160405261154c9190810190614395565b60035473ffffffffffffffffffffffffffffffffffffffff163314612b47576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602560248201527f4c535031343a2063616c6c6572206973206e6f74207468652070656e64696e6760448201527f4f776e6572000000000000000000000000000000000000000000000000000000606482015260840161059f565b612b5033612449565b600380547fffffffffffffffffffffffff0000000000000000000000000000000000000000169055565b600054610100900460ff16612c11576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602b60248201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960448201527f6e697469616c697a696e67000000000000000000000000000000000000000000606482015260840161059f565b612c1a81613691565b6112d17feafec4d89fa9619884b600005ef83ad9559033e6e941db7d7c495acdce61634760001b6040518060400160405280600481526020017f5ef83ad9000000000000000000000000000000000000000000000000000000008152506123d5565b3073ffffffffffffffffffffffffffffffffffffffff821603612ccb576040517f43b248cd00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600380547fffffffffffffffffffffffff00000000000000000000000000000000000000001673ffffffffffffffffffffffffffffffffffffffff929092169190911790556000600255565b60007fffffffff0000000000000000000000000000000000000000000000000000000082167f629aa694000000000000000000000000000000000000000000000000000000001480610671575061067182613765565b6000807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0831115612da45750600090506003612e53565b6040805160008082526020820180845289905260ff881692820192909252606081018690526080810185905260019060a0016020604051602081039080840390855afa158015612df8573d6000803e3d6000fd5b50506040517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0015191505073ffffffffffffffffffffffffffffffffffffffff8116612e4c57600060019250925050612e53565b9150600090505b94509492505050565b81612e6b57612e6b83826137fc565b602081511080612eaa575060006020612e8383614860565b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000911b1614155b15610f145782816040517fd088ec4000000000000000000000000000000000000000000000000000000000815260040161059f9291906145de565b606082471015612f2a576040517f0df9a8f80000000000000000000000000000000000000000000000000000000081524760048201526024810184905260440161059f565b8273ffffffffffffffffffffffffffffffffffffffff851660007f4810874456b8e6487bd861375cf6abd8e1c8bb5858c8ce36a86a04dabfac199e612f6e866148e4565b6040517fffffffff00000000000000000000000000000000000000000000000000000000909116815260200160405180910390a46000808573ffffffffffffffffffffffffffffffffffffffff168585604051612fcb9190614268565b60006040518083038185875af1925050503d8060008114613008576040519150601f19603f3d011682016040523d82523d6000602084013e61300d565b606091505b509150915061305282826040518060400160405280601681526020017f455243373235583a20556e6b6e6f776e204572726f7200000000000000000000815250613678565b9695505050505050565b6060824710156130a1576040517f0df9a8f80000000000000000000000000000000000000000000000000000000081524760048201526024810184905260440161059f565b81516000036130dc576040517fb81cd8d900000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600082516020840185f0905073ffffffffffffffffffffffffffffffffffffffff8116613135576040517f0b07489b00000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b838173ffffffffffffffffffffffffffffffffffffffff1660017fa1fb700aaee2ae4a2ff6f91ce7eba292f89c2f5488b8ec4c5c5c8150692595c36000801b60405161318391815260200190565b60405180910390a46040517fffffffffffffffffffffffffffffffffffffffff000000000000000000000000606083901b16602082015260340160405160208183030381529060405291505092915050565b60608151600003613212576040517fb81cd8d900000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b600061322b83602085516132269190614930565b613842565b90506000613248846000602087516132439190614930565b6134fe565b905060006132578684846138c2565b9050858173ffffffffffffffffffffffffffffffffffffffff1660027fa1fb700aaee2ae4a2ff6f91ce7eba292f89c2f5488b8ec4c5c5c8150692595c3866040516132a491815260200190565b60405180910390a46040517fffffffffffffffffffffffffffffffffffffffff000000000000000000000000606083901b166020820152603401604051602081830303815290604052935050505092915050565b6060600073ffffffffffffffffffffffffffffffffffffffff841660037f4810874456b8e6487bd861375cf6abd8e1c8bb5858c8ce36a86a04dabfac199e61333f866148e4565b6040517fffffffff00000000000000000000000000000000000000000000000000000000909116815260200160405180910390a46000808473ffffffffffffffffffffffffffffffffffffffff168460405161339b9190614268565b600060405180830381855afa9150503d80600081146133d6576040519150601f19603f3d011682016040523d82523d6000602084013e6133db565b606091505b509150915061205782826040518060400160405280601681526020017f455243373235583a20556e6b6e6f776e204572726f7200000000000000000000815250613678565b6060600073ffffffffffffffffffffffffffffffffffffffff841660047f4810874456b8e6487bd861375cf6abd8e1c8bb5858c8ce36a86a04dabfac199e613467866148e4565b6040517fffffffff00000000000000000000000000000000000000000000000000000000909116815260200160405180910390a46000808473ffffffffffffffffffffffffffffffffffffffff16846040516134c39190614268565b600060405180830381855af49150503d80600081146133d6576040519150601f19603f3d011682016040523d82523d6000602084013e6133db565b60608161350c81601f6148d1565b1015613574576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152600e60248201527f736c6963655f6f766572666c6f77000000000000000000000000000000000000604482015260640161059f565b61357e82846148d1565b845110156135e8576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601160248201527f736c6963655f6f75744f66426f756e6473000000000000000000000000000000604482015260640161059f565b606082158015613607576040519150600082526020820160405261366f565b6040519150601f8416801560200281840101858101878315602002848b0101015b81831015613640578051835260209283019201613628565b5050858452601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016604052505b50949350505050565b60608315613687575081611c71565b611c718383613a21565b600054610100900460ff16613728576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602b60248201527f496e697469616c697a61626c653a20636f6e7472616374206973206e6f74206960448201527f6e697469616c697a696e67000000000000000000000000000000000000000000606482015260840161059f565b341561375c57604051349033907f7e71433ddf847725166244795048ecf3e3f9f35628254ecbf73605666423349390600090a35b6112d181612449565b60007fffffffff0000000000000000000000000000000000000000000000000000000082167f7545acac00000000000000000000000000000000000000000000000000000000148061067157507f01ffc9a7000000000000000000000000000000000000000000000000000000007fffffffff00000000000000000000000000000000000000000000000000000000831614610671565b80511561380c5780518082602001fd5b6040517f8c6a8ae3000000000000000000000000000000000000000000000000000000008152821515600482015260240161059f565b600061384f8260206148d1565b835110156138b9576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601560248201527f746f427974657333325f6f75744f66426f756e64730000000000000000000000604482015260640161059f565b50016020015190565b60008347101561392e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601d60248201527f437265617465323a20696e73756666696369656e742062616c616e6365000000604482015260640161059f565b8151600003613999576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820181905260248201527f437265617465323a2062797465636f6465206c656e677468206973207a65726f604482015260640161059f565b8282516020840186f5905073ffffffffffffffffffffffffffffffffffffffff8116611c71576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601960248201527f437265617465323a204661696c6564206f6e206465706c6f7900000000000000604482015260640161059f565b815115613a315781518083602001fd5b806040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161059f919061401a565b7fffffffff00000000000000000000000000000000000000000000000000000000811681146112d157600080fd5b600060208284031215613aa557600080fd5b8135611c7181613a65565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b604051601f82017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016810167ffffffffffffffff81118282101715613b2657613b26613ab0565b604052919050565b600067ffffffffffffffff821115613b4857613b48613ab0565b50601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe01660200190565b600082601f830112613b8557600080fd5b8135613b98613b9382613b2e565b613adf565b818152846020838601011115613bad57600080fd5b816020850160208301376000918101602001919091529392505050565b60008060408385031215613bdd57600080fd5b82359150602083013567ffffffffffffffff811115613bfb57600080fd5b613c0785828601613b74565b9150509250929050565b803573ffffffffffffffffffffffffffffffffffffffff81168114613c3557600080fd5b919050565b60008083601f840112613c4c57600080fd5b50813567ffffffffffffffff811115613c6457600080fd5b602083019150836020828501011115611cb657600080fd5b60008060008060608587031215613c9257600080fd5b613c9b85613c11565b9350613ca960208601613c11565b9250604085013567ffffffffffffffff811115613cc557600080fd5b613cd187828801613c3a565b95989497509550505050565b600067ffffffffffffffff821115613cf757613cf7613ab0565b5060051b60200190565b600082601f830112613d1257600080fd5b81356020613d22613b9383613cdd565b82815260059290921b84018101918181019086841115613d4157600080fd5b8286015b84811015613d5c5780358352918301918301613d45565b509695505050505050565b600082601f830112613d7857600080fd5b81356020613d88613b9383613cdd565b82815260059290921b84018101918181019086841115613da757600080fd5b8286015b84811015613d5c57803567ffffffffffffffff811115613dcb5760008081fd5b613dd98986838b0101613b74565b845250918301918301613dab565b60008060008060808587031215613dfd57600080fd5b843567ffffffffffffffff80821115613e1557600080fd5b613e2188838901613d01565b9550602091508187013581811115613e3857600080fd5b8701601f81018913613e4957600080fd5b8035613e57613b9382613cdd565b81815260059190911b8201840190848101908b831115613e7657600080fd5b928501925b82841015613e9b57613e8c84613c11565b82529285019290850190613e7b565b97505050506040870135915080821115613eb457600080fd5b613ec088838901613d01565b93506060870135915080821115613ed657600080fd5b50613ee387828801613d67565b91505092959194509250565b60005b83811015613f0a578181015183820152602001613ef2565b50506000910152565b60008151808452613f2b816020860160208601613eef565b601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0169290920160200192915050565b600081518084526020808501808196508360051b8101915082860160005b85811015613fa5578284038952613f93848351613f13565b98850198935090840190600101613f7b565b5091979650505050505050565b602081526000611c716020830184613f5d565b60008060008060808587031215613fdb57600080fd5b84359350613feb60208601613c11565b925060408501359150606085013567ffffffffffffffff81111561400e57600080fd5b613ee387828801613b74565b602081526000611c716020830184613f13565b60008060006060848603121561404257600080fd5b833567ffffffffffffffff8082111561405a57600080fd5b61406687838801613d01565b9450602086013591508082111561407c57600080fd5b5061408986828701613d67565b92505061409860408501613c11565b90509250925092565b6000602082840312156140b357600080fd5b5035919050565b600080602083850312156140cd57600080fd5b823567ffffffffffffffff808211156140e557600080fd5b818501915085601f8301126140f957600080fd5b81358181111561410857600080fd5b8660208260051b850101111561411d57600080fd5b60209290920196919550909350505050565b60008060006040848603121561414457600080fd5b83359250602084013567ffffffffffffffff81111561416257600080fd5b61416e86828701613c3a565b9497909650939450505050565b6000806040838503121561418e57600080fd5b823567ffffffffffffffff808211156141a657600080fd5b6141b286838701613d01565b935060208501359150808211156141c857600080fd5b50613c0785828601613d67565b6000602082840312156141e757600080fd5b611c7182613c11565b60006020828403121561420257600080fd5b813567ffffffffffffffff81111561421957600080fd5b610cec84828501613d01565b8385823760609290921b7fffffffffffffffffffffffffffffffffffffffff00000000000000000000000016919092019081526014810191909152603401919050565b6000825161427a818460208701613eef565b9190910192915050565b828152604060208201526000610cec6040830184613f13565b6000602082840312156142af57600080fd5b5051919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b606080825284519082018190526000906020906080840190828801845b8281101561431e57815184529284019290840190600101614302565b505050838103828501526143328187613f5d565b9250505073ffffffffffffffffffffffffffffffffffffffff83166040830152949350505050565b84815273ffffffffffffffffffffffffffffffffffffffff841660208201528260408201526080606082015260006130526080830184613f13565b6000602082840312156143a757600080fd5b815167ffffffffffffffff8111156143be57600080fd5b8201601f810184136143cf57600080fd5b80516143dd613b9382613b2e565b8181528560208385010111156143f257600080fd5b612057826020830160208601613eef565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b60008083357fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe184360301811261446757600080fd5b83018035915067ffffffffffffffff82111561448257600080fd5b602001915036819003821315611cb657600080fd5b8183823760009101908152919050565b6000815160208301517fffffffffffffffffffffffffffffffffffffffff000000000000000000000000808216935060148310156144ef5780818460140360031b1b83161693505b505050919050565b60408152600061450a6040830185613f13565b82810360208401526120578185613f13565b8183528181602085013750600060208284010152600060207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe0601f840116840101905092915050565b60408152600061457960408301858761451c565b82810360208401526130528185613f13565b73ffffffffffffffffffffffffffffffffffffffff8516815283602082015260606040820152600061305260608301848661451c565b6000602082840312156145d357600080fd5b8151611c7181613a65565b8215158152604060208201526000610cec6040830184613f13565b7fffffffffffffffffffffffffffffffffffffffff0000000000000000000000008560601b16815283601482015281836034830137600091016034019081529392505050565b600181811c9082168061465357607f821691505b6020821081036118ba577f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b601f821115610f1457600081815260208120601f850160051c810160208610156146b35750805b601f850160051c820191505b818110156146d2578281556001016146bf565b505050505050565b815167ffffffffffffffff8111156146f4576146f4613ab0565b61470881614702845461463f565b8461468c565b602080601f83116001811461475b57600084156147255750858301515b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff600386901b1c1916600185901b1785556146d2565b6000858152602081207fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe08616915b828110156147a857888601518255948401946001909101908401614789565b50858210156147e457878501517fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff600388901b60f8161c191681555b5050505050600190811b01905550565b83815260406020820152600061205760408301848661451c565b60008451614820818460208901613eef565b60609490941b7fffffffffffffffffffffffffffffffffffffffff0000000000000000000000001691909301908152601481019190915260340192915050565b805160208083015191908110156118ba577fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff60209190910360031b1b16919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b80820180821115610671576106716148a2565b6000815160208301517fffffffff00000000000000000000000000000000000000000000000000000000808216935060048310156144ef5760049290920360031b82901b161692915050565b81810381811115610671576106716148a256fea26469706673582212204c716f85d1145bcbe75de9c2eb2914430942e4f65ea5e7afda664b1551460c7f64736f6c63430008110033";
    const upInitTx = await signer.sendTransaction({
      to: NICK_FACTORY_ADDRESS,
      data,
    });
    await upInitTx.wait();
    console.log("UniversalProfileInitPostDeploymentModule deployed");
  }

  if (!isLSP1URDDeployed) {
    const data =
      "0xfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeedfeed608060405234801561001057600080fd5b50611cb2806100206000396000f3fe608060405234801561001057600080fd5b50600436106100415760003560e01c806301ffc9a714610046578063a245bbda1461006e578063ffa1ad741461008e575b600080fd5b6100596100543660046117b7565b6100ca565b60405190151581526020015b60405180910390f35b61008161007c366004611857565b610133565b6040516100659190611959565b6100816040518060400160405280600681526020017f302e31322e31000000000000000000000000000000000000000000000000000081525081565b60006001600160e01b031982167fa245bbda00000000000000000000000000000000000000000000000000000000148061012d57507f01ffc9a7000000000000000000000000000000000000000000000000000000006001600160e01b03198316145b92915050565b60607fbd65385f96fc24363ec2034c362ee207e6ba7e05fb8369285be8e038bfd6a716830161016c57610165856102dc565b90506102d4565b7fdf7fb9ee4c1d15de3b7f23b9aebddef530b5db7a6b8abe88f13e0478211b5aa483016101bd57610165857fdaa746b70000000000000000000000000000000000000000000000000000000061043e565b7f4dc1518192ea9b4d6a4b3c1c41bfd265d0f8893a8420c9a6fcb690905b7e550083016101ed57610165856102dc565b7ff4f7b5aa1408f02c3f9028aad96253dded3b2c0f0b2f6f8687f405af3e4d67b3830161023e57610165857f30dc52780000000000000000000000000000000000000000000000000000000061043e565b7ff39dd1a71948f7651ca0e50e3792668416d0322736af69adfdd2be559ae96b8f830161026e57610165856105b0565b7f867aa368243da631c6abde26cc2843f9664f0ea9e06770f656179cc02abd01a4830161029e576101658561062f565b5060408051808201909152601981527f4c5350313a20747970654964206f7574206f662073636f70650000000000000060208201525b949350505050565b606081326001600160a01b038216036103185760405163a529534560e01b81526001600160a01b03821660048201526024015b60405180910390fd5b6040516370a0823160e01b81523360048201526001600160a01b038416906370a0823190602401602060405180830381865afa925050508015610378575060408051601f3d908101601f191682019092526103759181019061196c565b60015b61039c576040518060600160405280602d8152602001611c50602d91399150610438565b80156103e0576040518060400160405280601e81526020017f4c5350313a2066756c6c2062616c616e6365206973206e6f742073656e740000815250925050610438565b506000806103ee3386610673565b915091508151600014801561040257508051155b15610429576040518060600160405280602b8152602001611bf9602b913993505050610438565b6104338282610877565b935050505b50919050565b606082326001600160a01b038216036104755760405163a529534560e01b81526001600160a01b038216600482015260240161030f565b6001600160a01b0384163b15610551576040516370a0823160e01b81523360048201526001600160a01b038516906370a0823190602401602060405180830381865afa9250505080156104e5575060408051601f3d908101601f191682019092526104e29181019061196c565b60015b610509576040518060600160405280602d8152602001611c50602d913991506105a9565b8060000361054f576040518060400160405280601581526020017f4c5350313a2062616c616e6365206973207a65726f00000000000000000000008152509250506105a9565b505b60008061055f338787610934565b915091508151600014801561057357508051155b1561059a576040518060600160405280602b8152602001611bf9602b9139935050506105a9565b6105a48282610877565b935050505b5092915050565b606081326001600160a01b038216036105e75760405163a529534560e01b81526001600160a01b038216600482015260240161030f565b6000806105f43386610c48565b915091508151600014801561060857508051155b15610429576040518060600160405280602c8152602001611c24602c913993505050610438565b606081326001600160a01b038216036106665760405163a529534560e01b81526001600160a01b038216600482015260240161030f565b6000806105f43386610e38565b60608083600061068282611151565b905061068d816111e1565b610698575050610870565b60006106a382611985565b6001600160801b031916036106b9575050610870565b600060016106c683611985565b60801c6106d391906119d3565b905060006106f269812c4334633eb816c80d60b01b606089901b6111fc565b6040516354f6127f60e01b8152600481018290529091506000906001600160a01b038616906354f6127f90602401600060405180830381865afa15801561073d573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261076591908101906119f3565b9050805160141461077a575050505050610870565b6000602061078783611a6a565b6bffffffffffffffffffffffff1916901b60801c905060006107c97f6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b83611266565b9050846001600160801b0316826001600160801b031603610820576108107f6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b868387611291565b9850985050505050505050610870565b846001600160801b0316826001600160801b0316101561086857610810877f6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b878486896113f9565b505050505050505b9250929050565b6040517f9790242100000000000000000000000000000000000000000000000000000000815260609033906397902421906108b89086908690600401611aa2565b600060405180830381600087803b1580156108d257600080fd5b505af19250505080156108e3575060015b61091e573d808015610911576040519150601f19603f3d011682016040523d82523d6000602084013e610916565b606091505b50905061012d565b5060408051602081019091526000815292915050565b60608084600061094382611151565b905061094e816111e1565b61098557805160000361097e57604051600060208201526030016040516020818303038152906040529050610985565b5050610c40565b600061099082611985565b60801c90506ffffffffffffffffffffffffffffffffe1981016109b557505050610c40565b60006109d269812c4334633eb816c80d60b01b60608a901b6111fc565b6040516354f6127f60e01b8152600481018290529091506001600160a01b038516906354f6127f90602401600060405180830381865afa158015610a1a573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610a4291908101906119f3565b5115610a515750505050610c40565b6040805160038082526080820190925290602082016060803683370190505060408051600380825260808201909252919750816020015b6060815260200190600190039081610a885790505094507f6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b60001b86600081518110610ad657610ad6611b3a565b6020908102919091010152610aec826001611b50565b604051602001610b0f919060809190911b6001600160801b031916815260100190565b60405160208183030381529060405285600081518110610b3157610b31611b3a565b6020908102919091010152610b667f6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b83611266565b86600181518110610b7957610b79611b3a565b60200260200101818152505087604051602001610bae919060609190911b6bffffffffffffffffffffffff1916815260140190565b60405160208183030381529060405285600181518110610bd057610bd0611b3a565b60200260200101819052508086600281518110610bef57610bef611b3a565b6020026020010181815250508683604051602001610c0e929190611b70565b60405160208183030381529060405285600281518110610c3057610c30611b3a565b6020026020010181905250505050505b935093915050565b606080836000610c5782611768565b9050610c62816111e1565b610c6d575050610870565b80511580610c8d57506000610c8182611985565b6001600160801b031916145b15610c99575050610870565b60006001610ca683611985565b60801c610cb391906119d3565b90506000610cd26906491230f03e231fc8e360b21b606089901b6111fc565b6040516354f6127f60e01b8152600481018290529091506000906001600160a01b038616906354f6127f90602401600060405180830381865afa158015610d1d573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610d4591908101906119f3565b90508051601414610d5a575050505050610870565b60006020610d6783611a6a565b6bffffffffffffffffffffffff1916901b60801c90506000610da97f55482936e01da86729a45d2b87a6b1d3bc582bea0ec00e38bdb340e3af6f9f0683611266565b9050846001600160801b0316826001600160801b031603610df0576108107f55482936e01da86729a45d2b87a6b1d3bc582bea0ec00e38bdb340e3af6f9f06868387611291565b846001600160801b0316826001600160801b0316101561086857610810877f55482936e01da86729a45d2b87a6b1d3bc582bea0ec00e38bdb340e3af6f9f06878486896113f9565b606080836000610e4782611768565b9050610e52816111e1565b610e89578051600003610e8257604051600060208201526030016040516020818303038152906040529050610e89565b5050610870565b6000610e9482611985565b60801c90506ffffffffffffffffffffffffffffffffe198101610eb957505050610870565b6000610ed66906491230f03e231fc8e360b21b606089901b6111fc565b6040516354f6127f60e01b8152600481018290529091506001600160a01b038516906354f6127f90602401600060405180830381865afa158015610f1e573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f19168201604052610f4691908101906119f3565b5115610f555750505050610870565b6040805160038082526080820190925290602082016060803683370190505060408051600380825260808201909252919750816020015b6060815260200190600190039081610f8c5790505094507f55482936e01da86729a45d2b87a6b1d3bc582bea0ec00e38bdb340e3af6f9f0660001b86600081518110610fda57610fda611b3a565b6020908102919091010152610ff0826001611b50565b604051602001611013919060809190911b6001600160801b031916815260100190565b6040516020818303038152906040528560008151811061103557611035611b3a565b602090810291909101015261106a7f55482936e01da86729a45d2b87a6b1d3bc582bea0ec00e38bdb340e3af6f9f0683611266565b8660018151811061107d5761107d611b3a565b602002602001018181525050866040516020016110b2919060609190911b6bffffffffffffffffffffffff1916815260140190565b604051602081830303815290604052856001815181106110d4576110d4611b3a565b602002602001018190525080866002815181106110f3576110f3611b3a565b6020026020010181815250506328af17e660e01b83604051602001611119929190611b70565b6040516020818303038152906040528560028151811061113b5761113b611b3a565b6020026020010181905250505050509250929050565b6040516354f6127f60e01b81527f6460ee3c0aac563ccbf76d6e1d07bada78e3a9514e6382b736ed3f478ab7b90b60048201526060906001600160a01b038316906354f6127f906024015b600060405180830381865afa1580156111b9573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261012d91908101906119f3565b600081516010036111f457506001919050565b506000919050565b604080517fffffffffffffffffffff00000000000000000000000000000000000000000000841660208201526000602a82018190526bffffffffffffffffffffffff198416602c830152918291015b6040516020818303038152906040529050806102d490611ba0565b604080516001600160801b03198085166020830152608084901b16603082015260009182910161124b565b604080516003808252608082019092526060918291906020820183803683370190505060408051600380825260808201909252919350816020015b60608152602001906001900390816112cc57905050905085826000815181106112f7576112f7611b3a565b60200260200101818152505084604051602001611327919060809190911b6001600160801b031916815260100190565b6040516020818303038152906040528160008151811061134957611349611b3a565b6020026020010181905250828260018151811061136857611368611b3a565b602002602001018181525050604051806020016040528060008152508160018151811061139757611397611b3a565b602002602001018190525083826002815181106113b6576113b6611b3a565b60200260200101818152505060405180602001604052806000815250816002815181106113e5576113e5611b3a565b602002602001018190525094509492505050565b60408051600580825260c082019092526060918291906020820160a0803683370190505060408051600580825260c08201909252919350816020015b6060815260200190600190039081611435579050509050868260008151811061146057611460611b3a565b60200260200101818152505085604051602001611490919060809190911b6001600160801b031916815260100190565b604051602081830303815290604052816000815181106114b2576114b2611b3a565b602002602001018190525082826001815181106114d1576114d1611b3a565b602002602001018181525050604051806020016040528060008152508160018151811061150057611500611b3a565b602002602001018190525060006115178888611266565b6040516354f6127f60e01b8152600481018290529091506000906001600160a01b038b16906354f6127f90602401600060405180830381865afa158015611562573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f1916820160405261158a91908101906119f3565b61159390611a6a565b905086846002815181106115a9576115a9611b3a565b602002602001018181525050806040516020016115db91906bffffffffffffffffffffffff1991909116815260140190565b604051602081830303815290604052836002815181106115fd576115fd611b3a565b6020026020010181905250818460038151811061161c5761161c611b3a565b602002602001018181525050604051806020016040528060008152508360038151811061164b5761164b611b3a565b6020026020010181905250600061166286836111fc565b6040516354f6127f60e01b8152600481018290529091506000906001600160a01b038d16906354f6127f90602401600060405180830381865afa1580156116ad573d6000803e3d6000fd5b505050506040513d6000823e601f3d908101601f191682016040526116d591908101906119f3565b6116de90611bc4565b6040516001600160e01b031990911660208201526001600160801b031960808a901b1660248201526034016040516020818303038152906040529050818660048151811061172e5761172e611b3a565b602002602001018181525050808560048151811061174e5761174e611b3a565b602002602001018190525050505050965096945050505050565b6040516354f6127f60e01b81527f55482936e01da86729a45d2b87a6b1d3bc582bea0ec00e38bdb340e3af6f9f0660048201526060906001600160a01b038316906354f6127f9060240161119c565b6000602082840312156117c957600080fd5b81356001600160e01b0319811681146117e157600080fd5b9392505050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f1916810167ffffffffffffffff81118282101715611827576118276117e8565b604052919050565b600067ffffffffffffffff821115611849576118496117e8565b50601f01601f191660200190565b6000806000806080858703121561186d57600080fd5b84356001600160a01b038116811461188457600080fd5b93506020850135925060408501359150606085013567ffffffffffffffff8111156118ae57600080fd5b8501601f810187136118bf57600080fd5b80356118d26118cd8261182f565b6117fe565b8181528860208385010111156118e757600080fd5b8160208401602083013760006020838301015280935050505092959194509250565b60005b8381101561192457818101518382015260200161190c565b50506000910152565b60008151808452611945816020860160208601611909565b601f01601f19169290920160200192915050565b6020815260006117e1602083018461192d565b60006020828403121561197e57600080fd5b5051919050565b6000815160208301516001600160801b0319808216935060108310156119b55780818460100360031b1b83161693505b505050919050565b634e487b7160e01b600052601160045260246000fd5b6001600160801b038281168282160390808211156105a9576105a96119bd565b600060208284031215611a0557600080fd5b815167ffffffffffffffff811115611a1c57600080fd5b8201601f81018413611a2d57600080fd5b8051611a3b6118cd8261182f565b818152856020838501011115611a5057600080fd5b611a61826020830160208601611909565b95945050505050565b805160208201516bffffffffffffffffffffffff1980821692919060148310156119b55760149290920360031b82901b161692915050565b604080825283519082018190526000906020906060840190828701845b82811015611adb57815184529284019290840190600101611abf565b50505083810382850152845180825282820190600581901b8301840187850160005b83811015611b2b57601f19868403018552611b1983835161192d565b94870194925090860190600101611afd565b50909998505050505050505050565b634e487b7160e01b600052603260045260246000fd5b6001600160801b038181168382160190808211156105a9576105a96119bd565b6001600160e01b03198316815260008251611b92816004850160208701611909565b919091016004019392505050565b805160208083015191908110156104385760001960209190910360031b1b16919050565b6000815160208301516001600160e01b0319808216935060048310156119b55760049290920360031b82901b16169291505056fe4c5350353a204572726f722067656e65726174696e672064617461206b65792f76616c75652070616972734c535031303a204572726f722067656e65726174696e672064617461206b65792f76616c75652070616972734c5350313a206062616c616e63654f66286164647265737329602066756e6374696f6e206e6f7420666f756e64a264697066735822122075f0c68d40b16e047706a2963d1434231a8a74003043037b004f12b53f57b55164736f6c63430008110033";
    const lsp1URDTx = await signer.sendTransaction({
      to: NICK_FACTORY_ADDRESS,
      data,
    });
    await lsp1URDTx.wait();
    console.log("LSP1UniversalReceiverDelegateUP deployed");
  }

  await deploy("upRegistry", {
    from: deployer,
    args: [],
    log: true,
    autoMine: true,
  });
  // const upRegistry = await hre.ethers.getContract("upRegistry", deployer);

  await deploy("upDevAccountOwnership", {
    from: deployer,
    args: ["Account Ownership", "UPDEV", deployer],
    log: true,
    autoMine: true,
  });
  const collection = await hre.ethers.getContract("upDevAccountOwnership", deployer);

  await deploy("upDevFunctionsConsumer", {
    from: deployer,
    args: [process.env.DON_ROUTER, process.env.DON_ID, collection.address],
    log: true,
    autoMine: true,
  });
  const consumer = await hre.ethers.getContract("upDevFunctionsConsumer", deployer);

  // Register Chainlink Functions consumer
  try {
    const router = await hre.ethers.getContractAt("IChainlinkFunctionsRouter", process.env.DON_ROUTER || "", deployer);
    const [isAdded] = await router.getConsumer(consumer.address, process.env.DON_SUB_ID);
    if (isAdded) {
      throw new Error("skip");
    }
    const tx = await router.addConsumer(process.env.DON_SUB_ID, consumer.address);
    console.log("Adding consumer...", consumer.address);
    await tx.wait();
    console.log("Consumer added");
  } catch (e) {
    console.log("Consumer already added");
  }

  // Transfer NFT collection ownership to consumer contract
  try {
    await collection.transferOwnership(consumer.address);
    console.log("Collection ownership transferred to", consumer.address);
  } catch (e) {
    const owner = await collection.owner();
    const consumerAddress = await consumer.resolvedAddress;
    if (owner !== consumerAddress) {
      console.error("Collection owner is invalid: ", owner, "Must be", consumer.address);
      return;
    } else {
      console.log("Collection ownership already transferred");
    }
  }

  const addSource = async (name: string) => {
    try {
      await consumer.addSource(name, getSourceCode(name));
      console.log(`Source ${name} added`);
    } catch (e) {
      console.log(`Source ${name} already added`);
    }
  };

  await addSource("twitter");

  console.log("consumer.sendRequest( twitter )...");
  const tx = await consumer.sendRequest(
    process.env.DON_SUB_ID,
    "0x",
    0,
    0,
    "twitter",
    "QmP2Wpt6eCPrRkNjQmfDkvhdbgtC79ATHVz9Q1cBsY5WUR", // IPFS HASH
    "BorisShevc64479",
  );
  tx.wait().then(() => {
    console.log("consumer.sendRequest( twitter ): waiting for Response...");
  });

  consumer.on("Response", async (id, request) => {
    if (!request.isOwned) {
      console.log("Request failed", request);
      return;
    }
    try {
      await consumer.claimToken(request.tokenId);
      console.log(`${request.source} - ${id} token claimed by ${request.up}`);
    } catch (e: any) {
      if (e.message.includes("replacement fee too low")) {
        await wait(3000);
        await consumer.claimToken(request.tokenId);
      } else {
        console.error("Claim token failed", request.tokenId, e);
      }
    }
  });

  await wait(100);

  // await deploy("LSP23LinkedContractsFactory", {
  //   from: deployer,
  //   // Contract constructor arguments
  //   args: [],
  //   log: true,
  //   autoMine: true,
  // });

  // Get the deployed contract
  // const lsp23 = await hre.ethers.getContract("LSP23LinkedContractsFactory", deployer);
};

export default deployYourContract;

// Tags are useful if you have multiple deploy files and only want to run one of them.
// e.g. yarn deploy --tags YourContract
deployYourContract.tags = ["LSP23LinkedContractsFactory"];
